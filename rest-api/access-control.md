# アクセスコントロール

## 概要

REST APIのアクセスコントロールは、認証と認可の2つの概念に基づいています。

- 認証（Authentication）: ユーザーが誰であるかを確認するプロセスです。ユーザーがシステムへログインするときに、ユーザー名とパスワードを入力するなどして自分の身元を証明します。
- 認可（Authorization）: ユーザーが特定のリソースやアクションにアクセスする権限を持っているかどうかを確認するプロセスです。認証されたユーザーが、自分に割り当てられた権限の範囲内でのみアクションを実行できるようにします。

ユーザーのプライバシーとデータセキュリティを保護するために、適切なアクセスコントロールを実装することが重要です。

## 認証

REST APIへのアクセスには、次の認証方式のいずれかが必要です。

### APIキー認証

APIキー認証は、ユーザーがAPIキーを使ってREST APIにアクセスする方法です。

APIキーは、ユーザーがAPIプロバイダーから取得する一意の文字列です。リクエストを送信する際に、`X-API-Key`というヘッダーにAPIキーを含めます。

APIキーは、ユーザーを識別し、アクセスを制御するために使用されます。たとえば、ユーザーはAPIプロバイダーのウェブサイトでアカウントを作成し、APIキーを取得します。その後、APIリクエストを送信する際に、取得したAPIキーをヘッダーに含めることで認証を行います。

### OAuth認証

OAuth（Open Authorization）は、ユーザーがサードパーティのアプリケーションにアクセス権を付与するための認証プロトコルです。

OAuthを使用すると、ユーザーはパスワードを共有することなく、APIプロバイダーが管理するリソースへのアクセスをサードパーティのアプリケーションに許可できます。

OAuth認証では、アクセストークン（ユーザーに代わってリソースにアクセスするための短期的な認証情報）を使用してAPIにアクセスします。
たとえば、ユーザーがサードパーティのアプリケーションを使用してソーシャルメディアのAPIにアクセスする場合、OAuthを使用してアクセストークンを取得し、APIリクエストにそのトークンを含めることで認証を行います。

### JWT認証

JWT（JSON Web Token）認証は、トークンベースの認証方式です。

JWTは、ユーザーの身元情報をエンコードした文字列で、APIリクエストのヘッダーに含めて送信します。APIサーバーは、JWTの署名を検証し、トークンに含まれる情報を使ってユーザーを認証します。JWTは、ステートレスな認証を可能にし、サーバー側でセッション情報を保持する必要がありません。

### OIDC認証

OIDC（OpenID Connect）は、OAuth 2.0プロトコルの上に構築された認証レイヤーです。

OIDCは、ユーザーの身元情報を検証し、APIへのアクセスを許可するために使用されます。OIDCでは、IDトークンとアクセストークンの両方が使用されます。IDトークンはユーザーの身元情報を含み、アクセストークンはAPIリソースへのアクセスを許可するために使用されます。
たとえば、ユーザーがOpenIDプロバイダー（GoogleやFacebookなど）を使用してアプリケーションにログインする場合、OIDCを使用してIDトークンとアクセストークンを取得し、APIリクエストにそれらのトークンを含めることで認証を行います。

## 認可

認可は、認証されたユーザーが特定のリソースやアクションにアクセスする権限を持っているかどうかを確認するプロセスです。REST APIでは、次のような認可メカニズムが一般的に使用されます。

### ロールベースのアクセス制御（RBAC）

RBACは、ユーザーの役割に基づいてアクセス権限を定義する方法です。

各ユーザーは1つ以上の役割に割り当てられ、各役割には特定のアクションやリソースに対するアクセス権限が関連付けられています。

たとえば、「管理者」の役割をもつユーザーはすべてのリソースに対する読み取りと書き込みアクセス権を持ち、「ゲスト」の役割をもつユーザーは一部のリソースに対する読み取り専用アクセス権をもつことができます。RBACは、シンプルで理解しやすい認可モデルであり、多くのシステムで広く使用されています。

### 属性ベースのアクセス制御（ABAC）

ABACは、ユーザーの属性や環境条件に基づいてアクセス権限を定義する方法です。

属性は、ユーザーの役職、所属部署、アクセス元のIPアドレスなどの情報を含むことができます。

たとえば、ABACを使用して、ユーザーの役職が「マネージャー」で、アクセス元のIPアドレスが社内ネットワークの範囲内である場合にのみ、機密情報へのアクセスを許可するといったアクセス制御が可能です。ABACは、よりきめ細かいアクセス制御を実現できますが、ポリシーの管理が複雑になる可能性があります。

### アクセス制御リスト（ACL）

ACLは、リソースごとにアクセス権限を定義する方法です。

各リソースには、そのリソースにアクセスできるユーザーやグループのリストが関連付けられています。

ACLでは、ユーザーやグループに対して、読み取り、書き込み、削除などの特定のアクションに対するアクセス権限を付与します。

## まとめ

REST APIのアクセスコントロールでは、認証と認可の両方が重要な役割を果たします。適切な認証メカニズムを使用してユーザーの身元を確認し、認可メカニズムを使用してユーザーのアクセス権限を制御することで、APIのセキュリティを確保できます。

APIの要件に応じて、APIキー、OAuth、JWT、OIDCなどの認証方式や、RBAC、ABAC、ACLなどの認可方式を選択し、適切に実装することが重要です。その際、APIの用途やセキュリティレベル、パフォーマンスなどを考慮して、最適な方式を選択する必要があります。

また、認証と認可の実装には注意が必要です。認証情報の適切な管理、セキュアな通信の使用、適切な認可ポリシーの定義と適用などを行うことで、APIのセキュリティを確保することができます。

認可されていないリソースにアクセスしようとした場合、一般的にAPIは`403 Forbidden`エラーを返しますが、そのエンドポイントが存在しないように見せかけるために`404 Not Found`エラーを返すこともあります。

REST APIのアクセスコントロールについて理解し、適切な認証と認可の方式を選択・実装することは、APIのセキュリティを確保するために不可欠です。APIの要件に合ったアクセスコントロールの仕組みを設計・実装してください。
